

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.2. Search limits and SearchLimits &mdash; or-tools User&#39;s Manual</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'doc version 0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/logo.ico"/>
    <link rel="top" title="or-tools User&#39;s Manual" href="../../index.html" />
    <link rel="up" title="7. Meta-heuristics: several previous problems" href="../metaheuristics.html" />
    <link rel="next" title="7.3. Large neighborhood search (LNS): the job-shop problem" href="jobshop_lns.html" />
    <link rel="prev" title="7.1. Meta-heuristics in or-tools" href="metaheuristics.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="jobshop_lns.html" title="7.3. Large neighborhood search (LNS): the job-shop problem"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="metaheuristics.html" title="7.1. Meta-heuristics in or-tools"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">or-tools User&#39;s Manual</a> &raquo;</li>
          <li><a href="../metaheuristics.html" accesskey="U">7. Meta-heuristics: several previous problems</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="search-limits-and-searchlimits">
<span id="search-limits-more-details"></span><h1>7.2. Search limits and <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s</h1>
<p>To control the search, we also need a way to stop the search when some criteria are met.</p>
<div class="section" id="an-example-of-a-custom-searchlimit">
<span id="no-improvement-limit-searchlimit"></span><h2>7.2.1. An example of a custom <tt class="docutils literal"><span class="pre">Searchlimit</span></tt></h2>
<p>We have already met <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s in the sub-section <a class="reference internal" href="../objectives/data_search.html#search-limits"><em>SearchLimits</em></a>. We go a little bit more into details here.</p>
<p>You&#8217;ll find the code in the file <tt class="file docutils literal"><span class="pre">common/limits.h</span></tt>.</p>
<p>It is not always possible to create a <tt class="docutils literal"><span class="pre">CustomLimit</span></tt> with an appropriate callback to meet a desired end search criterion.
For instance, let&#8217;s say we would like to stop the search after a certain number of solutions have been found but without
any improvements of the objective value. To do so, we need to have access to the objective value every time a new solution
has been found. The <tt class="docutils literal"><span class="pre">Solver</span></tt> class doesn&#8217;t provide any method to access its current objective value. What we need is a
custom <tt class="docutils literal"><span class="pre">SearchMonitor</span></tt>! Or more precisely, a custom <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s are specialized <tt class="docutils literal"><span class="pre">SearchMonitor</span></tt>s to end a <tt class="docutils literal"><span class="pre">Search</span></tt>. The <tt class="docutils literal"><span class="pre">SearchLimit</span></tt> class itself is a pure virtual
base class for all <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s. It&#8217;s only constructor is:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">explicit</span> <span class="nf">SearchLimit</span><span class="p">(</span><span class="n">Solver</span><span class="o">*</span> <span class="k">const</span> <span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<p>Several methods <strong>must</strong> be defined:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bool</span> <span class="pre">Check()</span></tt>: This method is called to check the status of the limit.
A return value of <tt class="docutils literal"><span class="pre">true</span></tt> indicates that we have indeed crossed the limit. In
that case, this method will not be called again and the remaining search will be discarded. This method is called
in the <tt class="docutils literal"><span class="pre">BeginNextDecision()</span></tt> and <tt class="docutils literal"><span class="pre">RefuteDecision()</span></tt> callbacks.</li>
<li><tt class="docutils literal"><span class="pre">void</span> <span class="pre">Init()</span></tt>: This method is called when the search limit is initialized in the <tt class="docutils literal"><span class="pre">EnterSearch()</span></tt> callback.</li>
<li><tt class="docutils literal"><span class="pre">void</span> <span class="pre">Copy(const</span> <span class="pre">SearchLimit*</span> <span class="pre">const</span> <span class="pre">limit)</span></tt>: Copy a limit. Warning: leads to a direct (no check) downcasting
of <tt class="docutils literal"><span class="pre">limit</span></tt>, so one needs to be sure both <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s are of the same type.</li>
<li><tt class="docutils literal"><span class="pre">SearchLimit*</span> <span class="pre">MakeClone()</span> <span class="pre">const</span></tt>: Allocates a clone of the limit.</li>
</ul>
<p>OK, let&#8217;s get our hands dirty and let&#8217;s code!</p>
<p>Our class inherits publicly from a <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NoImprovementLimit</span> <span class="o">:</span> <span class="k">public</span> <span class="n">SearchLimit</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>We&#8217;ll consider both minimizing and maximazing depending on a <tt class="docutils literal"><span class="pre">bool</span></tt> in the constructor:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NoImprovementLimit</span> <span class="o">:</span> <span class="k">public</span> <span class="n">SearchLimit</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">NoImprovementLimit</span><span class="p">(</span><span class="n">Solver</span> <span class="o">*</span> <span class="n">solver</span><span class="p">,</span>
                     <span class="kt">int</span> <span class="n">solution_nbr_tolerance</span><span class="p">,</span>
                     <span class="kt">bool</span> <span class="n">minimize</span> <span class="o">=</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">solution_nbr_tolerance</span></tt> represents the number of solutions we allow to be found without any improvements in the
objective value. If more solutions are found without any improvements in the objective value, we end the search.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<table>
<tr>
<td width="60"><img src="../../_static/logo.png" width="50" height="50"  alt="" /></td>
<td><p class="library_name">Google <a href="http://code.google.com/p/or-tools/"><strong>or-tools</strong></a><br>open source library</p></td>
</tr>
</table>
<h1>User's Manual</h1>

  
   



<h3>Google search</h3>

<form method="get" action="http://www.google.com/search">

<div style="padding:-1px;width:15em;">
<table border="0" cellpadding="0">
<tr><td>
<input type="text"   name="q" size="25"
 maxlength="255" value="" />
<input type="submit" value="Go" /></td></tr>
<tr><td align="center" style="font-size:80%">
Search:
<select name="sitesearch" width="125" style="width: 125px">
<option value="http://or-tools.googlecode.com/svn/trunk/documentation/user_manual/" selected>user's manual</option>
<option value="http://or-tools.googlecode.com/svn/trunk/documentation/faq/">faq</option>
<option value="http://or-tools.googlecode.com/svn/trunk/documentation/reference_manual/or-tools/">reference manual</option>
<option value="http://or-tools.googlecode.com/svn/trunk/documentation/">All or-tools doc</option>
</select>
</td></tr>
</table>
</div>

</form>
</br>




  <h3>Welcome</h3>
  
  <ul>
  	<li><a href="../../index.html">Content and foreword</a></li>
  	<li><a href="http://or-tools.googlecode.com/svn/trunk/documentation/documentation_hub.html">Documentation's hub</a></li>
	<li><a href="http://code.google.com/p/or-tools/">The or-tools open source library</a></li></li>	
  </ul>
  
   
	


  <h3>Tutorial examples</h3>
  
  <ul>
	<li><a href="http://or-tools.googlecode.com/svn/trunk/documentation/documentation_hub.html#tutorial_C++">C++</a></li>
	<li><a href="http://or-tools.googlecode.com/svn/trunk/documentation/documentation_hub.html#tutorial_Python">Python</a></li>	
	<li><a href="http://or-tools.googlecode.com/svn/trunk/documentation/documentation_hub.html#tutorial_Java">Java</a></li>
	<li><a href="http://or-tools.googlecode.com/svn/trunk/documentation/documentation_hub.html#tutorial_Csharp">C#</a></li>
</ul>
  
   
	

  <h3>Current chapter</h3>
  <p class="topless"><a href="../metaheuristics.html"
                        title="previous chapter">7. Meta-heuristics: several previous problems</a></p>
  <h3>Previous section</h3>
  <p class="topless"><a href="metaheuristics.html"
                        title="previous chapter">7.1. Meta-heuristics in <em>or-tools</em></a></p>
  <h3>Next section</h3>
  <p class="topless"><a href="jobshop_lns.html"
                        title="next chapter">7.3. Large neighborhood search (LNS): the job-shop problem</a></p>
  <h3>Current section</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.2. Search limits and <tt class="docutils literal"><span class="pre">SearchLimit</span></tt>s</a><ul>
<li><a class="reference internal" href="#an-example-of-a-custom-searchlimit">7.2.1. An example of a custom <tt class="docutils literal"><span class="pre">Searchlimit</span></tt></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="jobshop_lns.html" title="7.3. Large neighborhood search (LNS): the job-shop problem"
             >next</a> |</li>
        <li class="right" >
          <a href="metaheuristics.html" title="7.1. Meta-heuristics in or-tools"
             >previous</a> |</li>
        <li><a href="../../index.html">or-tools User&#39;s Manual</a> &raquo;</li>
          <li><a href="../metaheuristics.html" >7. Meta-heuristics: several previous problems</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2014, Google.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>